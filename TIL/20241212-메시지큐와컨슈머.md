### 메시지 큐
- 역할 : 데이터를 전달하기 위한 중간 저장소
  - 메시징 시스템에서 메시지를 생산자(Producer)가 보낸 뒤 소비자(Consumer)가 처리할 때까지 데이터를 임시로 저장
- 구현 방식 : FIFO (First In, First Out) 방식으로 동작하는 경우가 일반적이며, 메시지를 효율적으로 전달하는데 사용.
- 주요 특징
  - 비동기 처리를 가능하게 함
  - 데이터 생산과 소비의 분리를 통해 시스템의 유연성과 확장성을 높임
- 예시: RabbitMQ, Kafka, ActiveMQ등
- 

### 컨슈머
- 역할 : 메시지 큐에서 메시지를 읽고 처리하는 주체.
  - 메시징 시스템에서 큐에 쌓인 메시지를 꺼내 실제 작업 (예: 데이터처리, 저장, 알림 발송 등)을 수행
- 구현 방식: 애플리케이션 코드 또는 특정 워커 프로세스가 메시지 큐와 연결되어 메시지를 수신.
- 주요 특징
  - 메시지 큐에서 가져온 데이터를 처리하는 로직을 포함
  - 메시지를 가져온 후 성공적으로 처리되면 메시지를 삭제하거나 완료 상태로 표시
 
### 예시 - AWS SQS
- SQS 메시지 발행 및 대기열 유지
  - 생산자(SNS)는 236KB미만의 메시지를 전송
  - 메시지는 소비자가 메시지를 읽고 삭제할 때까지 SQS 대기열에 유지
- SQS 메시지 소비
  - 컨슈머는 SQS 메시지를 폴링
  - 컨슈머는 폴링한 메시지를 이용하여 작업
  - 작업이 완료된 후 컨슈머는 대기열에서 메세지 삭제
    - 메시지를 빠르게 삭제하지 않으면 다른 소비자도 메시지를 수신할 수 있음

### SQS - 메세지 로드밸런싱 개념
- 궁금증 : 컨슈머는 여러대 떠있잖아. 같은 메시지를 여러 서버가 받으면 안될거 같은데, 로드밸런싱 해주는 개념이 SQS에도 있어?
- 메시지 가시성 타임아웃
  - 가시성 타임아웃은 메시지가 한 컨슈머에게 전달된 후 다른 컨슈머가 동일한 메시지를 볼 수 없도록 하는 시간
  - 메세지를 한 컨슈머가 가져가면 SQS는 해당 메세지를 잠금 상태로 만들어 다른 컨슈머가 처리하지 못하도록함.
  - 이 타임아웃 내에 메세지가 처리되면 컨슈머는 SQS에 메시지 삭제 요청을 보내 큐에서 해당 메세지를 제거
  - 설정된 타임아웃이 지나면 메시지는 다시 큐에서 가용 상태로 변경되어 다른 컨슈머가 처리 할 수 있음
- 다중 컨슈머 환경에서 분산처리
  - 여러 컨슈머가 동시에 SQS 큐를 폴링하면, SQS는 각 메시지를 한 번에 하나의 컨슈머에게만 전달
  - 따라서 동일한 메시지가 여러 컨슈머에 의해 처리되지 않는다.
  - 컨슈머의 개수가 많아질수록 로드가 자동으로 분산되며, SQS 자체적으로 메시지를 균등하게 배포하려고 시도
- 스케일링을 통한 로드밸런싱
  - 컨슈머 애플리케이션을 여러 서버에서 실행하면, SQS가 자연스럽게 각 컨슈머에 메시지를 균등하게 할당
  - 컨슈머의 수가 증가하면 더 많은 메시지를 병렬로 처리 가능
- FIFO 큐에서 메시지 순서 보장
  - SQS FIFO 큐를 사용하면 메시지가 순서대로 처리되는 것을 보장.

### SQS 표준 큐와 FIFO 큐
- 궁금증 SQS가 로드밸런싱 되면 FIFO를 보장할 수 있어?
- SQS 표준 큐
  - 특징
    - 높은 처리량과 최소 1회 전송 보장
    - 메시지 순서를 보장하지 않음
    - 메시지가 중복 전달될 가능성이 있음
  - 로드밸런싱
    - 여러 컨슈머가 SQS 표준 큐를 동시에 폴링할 수 있으며 메시지는 균등하게 분배된다.
    - 순서가 중요하지 않은 비즈니스 로직에 적합
- SQS FIFO 큐
  - 특징
    - 메시지 순서를 보장 메시지는 FIFO로 처리
    - 중복 제거를 지원하여 메시지가 중복으로 전달되지 않도록 함
    - 처리량은 표준 큐에 비해 상대적으로 낮음
  - 로드밸런싱
    - FIFO 큐에서도 로드밸런싱이 가능. 다만, 순서 보장을 하기 위해 추가적인 제약이 있다.
    - FIFO 큐가 순서를 보장하면서 로드밸런싱을 수행하기 위해 메시지 그룹 ID를 사용
    - 메시지 그룹 ID
      - FIFO 큐에서 메시지는 메시지 그룹 ID에 따라 분류
      - 같은 메시지 그룹 ID에 속한 메시지는 순서대로 처리
      - 서로 다른 메시지 그룹 ID는 병렬로 처리 가능
    - 동작방식
      - SQS는 각 메시지 그룹 ID에 대해 단일 컨슈머만 메시지를 처리하도록 보장
      - 즉, 하나의 메시지 그룹 ID내에서는 순서가 유지되지만, 서로 다른 메시지 그룹 ID간에는 병렬처리가 가능
    - 로드밸런싱의 한계
      - 메시지 그룹 ID가 적을 경우, 일부 컨슈머만 메시지를 처리하게 되어 부하가 고르게 분산되지 않을 수 있다.
      - 메시지 그룹 ID를 다양하게 생성하면 더 나은 로드밸런싱 가능
  - FIFO 큐도 100% 순서보장은 하지 못함.   
          
