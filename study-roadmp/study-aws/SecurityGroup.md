# 보안 그룹 (Security Group)

## 개요
- 보안 그룹은 AWS EC2 인스턴스의 **가상 방화벽 역할**을 한다.
- EC2 인스턴스에 **어떤 트래픽을 허용할지 정의**하는 규칙 집합이다.
- EC2, RDS, Lambda (VPC 안), ALB 등 다양한 서비스에 적용된다.
- 기본적으로 모든 **인바운드 트래픽은 차단**, **아웃바운드는 모두 허용**된다.

## 인바운드와 아웃바운드

| 방향 | 기본 설정 | 설정 가능 항목 |
|------|------------|----------------|
| 인바운드 | 모두 차단 | 허용할 포트, 프로토콜, 소스 IP 또는 SG 지정 |
| 아웃바운드 | 모두 허용 | 제한 가능 (필요 시) |

## 구성 요소

| 항목 | 설명 |
|------|------|
| 유형(Type) | SSH, HTTP, HTTPS 등 미리 정의된 프로토콜 선택 가능 |
| 프로토콜 | TCP, UDP, ICMP 등 |
| 포트 범위 | 특정 포트 또는 범위 지정 (예: 22, 80, 1024-65535) |
| 소스(Source) / 목적지(Destination) | 허용할 IP 주소 또는 다른 보안 그룹 지정 가능 (예: 0.0.0.0/0, MySG) |

## 특징

- **스테이트풀(상태 저장형)**: 인바운드가 허용되면 **그에 대한 응답은 자동 허용**됨 (아웃바운드 따로 지정할 필요 없음)
- 인스턴스에 여러 보안 그룹을 **동시에 적용 가능**
- 보안 그룹 규칙은 **자동으로 즉시 적용**됨 (인스턴스를 재시작하지 않아도 됨)
- EC2와 RDS 각각 **보안 그룹 별도로 설정해야 함**

## 예시: SSH와 HTTP 허용 보안 그룹

| 유형 | 프로토콜 | 포트 | 소스 |
|------|----------|------|------|
| SSH | TCP | 22 | 0.0.0.0/0 |
| HTTP | TCP | 80 | 0.0.0.0/0 |

```bash
# 보안 그룹 적용 후 접속 예시
ssh -i my-key.pem ec2-user@<퍼블릭 IP>
```

## AWS Associate 시험 자주 출제 포인트

- EC2에 접근이 안 되는 경우 → **보안 그룹의 인바운드 규칙 확인**
- **0.0.0.0/0**: 모든 IP에서 접근 허용 (시험에서는 위험 요소로 지적될 수 있음)
- **보안 그룹 간 참조** 가능 → 웹 서버 SG에서 DB 서버 SG로 트래픽 허용 설정
- **네트워크 ACL(NACL)과의 차이점** 출제 가능 (보안 그룹은 상태 저장형, NACL은 상태 비저장형)

## 보안 그룹 vs NACL 요약

| 항목 | 보안 그룹 (SG) | NACL |
|------|----------------|------|
| 적용 대상 | EC2 인스턴스 등 | 서브넷 |
| 상태 저장 | 예 (Stateful) | 아니오 (Stateless) |
| 기본 규칙 | 인바운드 차단, 아웃바운드 허용 | 인/아웃 모두 기본 거부 |
| 규칙 수 | 상대적으로 적음 | 더 많음 |
| 사용 목적 | EC2 단위 보안 | 서브넷 레벨 접근 제어 |

## 요약
- 보안 그룹은 EC2 인스턴스의 방화벽 역할
- 인바운드는 명시적으로 열어줘야 함, 아웃바운드는 기본 허용
- 상태 저장형으로 응답 트래픽은 자동 허용됨
- 시험에서는 포트/프로토콜/IP 설정 및 접근 불가 원인으로 자주 출제됨

---

# 보안 그룹 간 참조 예시 - 웹 서버에서 DB 접속만 허용하기

## 개요
보안 그룹(Security Group)은 IP 주소뿐 아니라 **다른 보안 그룹을 참조**하여 트래픽을 허용할 수 있다.  
이 기능을 이용하면 **특정 역할(예: 웹 서버)만 데이터베이스에 접근하도록 제한**할 수 있다.

---

## 시나리오

- EC2 인스턴스 A (웹 서버) → 보안 그룹: `WebSG`
- EC2 인스턴스 B (DB 서버) → 보안 그룹: `DBSG`

목표: **웹 서버만 DB에 3306 포트로 접속 가능하도록 설정**

---

## 설정 방법

### `DBSG` 보안 그룹 인바운드 규칙

| 유형 | 프로토콜 | 포트 범위 | 소스 |
|------|----------|------------|--------|
| MySQL/Aurora | TCP | 3306 | 보안 그룹 `WebSG` |

- 이 설정은 `WebSG`가 적용된 인스턴스에서 오는 **3306 포트의 요청만 허용**함
- **IP 주소가 아니라 보안 그룹을 소스로 지정**하는 방식

---

## 결과

- ✅ `WebSG`가 적용된 인스턴스 A는 B의 3306 포트(MySQL)로 접속 가능
- ❌ 외부(인터넷)에서는 DB 인스턴스의 3306 포트에 접근 불가
- ❌ 다른 보안 그룹이 적용된 인스턴스도 접근 불가
- ❌ WebSG 인스턴스라도 **3306 이외의 포트 (예: 22)** 는 접근 불가

---

## 장점

- IP 기반 설정보다 **유지 보수가 쉬움** (인스턴스 IP가 바뀌어도 문제 없음)
- **역할 기반 보안 제어** 가능 (예: 웹 서버만 DB 접근 허용)
- VPC 내에서 **보다 안전한 내부 통신 설계 가능**

---

## 시험 포인트 정리

- 보안 그룹은 **다른 보안 그룹을 소스/목적으로 지정할 수 있다**
- EC2 인스턴스 간 통신을 제어할 때 유용하게 사용된다
- 0.0.0.0/0 같은 공개 IP보다 **보안 그룹 참조가 보안 측면에서 우수**
