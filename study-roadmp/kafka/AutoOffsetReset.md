# ✅ Kafka `auto.offset.reset` 정리

Kafka의 `auto.offset.reset`은 **컨슈머가 구독하는 토픽에서 저장된 오프셋이 없을 때**, 어디서부터 메시지를 읽을지를 결정하는 설정입니다.

---

## 🔍 언제 적용되는가?

- 컨슈머 그룹에 오프셋이 저장되어 있지 않은 경우
- 저장된 오프셋이 유효하지 않거나 삭제된 경우 (예: retention 초과)

이럴 때 Kafka는 `auto.offset.reset`의 설정에 따라 읽기 시작 위치를 결정합니다.

---

## 🛠 설정 값과 의미

| 설정 값     | 설명 |
|-------------|------|
| `earliest`  | 브로커에 저장된 가장 **처음(offset=0)**부터 메시지 읽기 시작 |
| `latest`    | 가장 **최근(마지막)** 메시지부터 읽기 시작 (기존 메시지는 무시) |
| `none`      | 오프셋이 없으면 예외 발생 (KafkaException)

---

## 📦 예시

### ✅ `earliest`
- 과거 메시지까지 모두 읽고 싶을 때 사용
- 예: 로그 수집, 데이터 분석, 재처리 등
- 단, 브로커가 메시지를 retention 기간 내에 보관하고 있어야 가능

### ✅ `latest` (기본값)
- 실시간 처리에 적합
- poll() 이후 도착하는 메시지만 소비

### ✅ `none`
- 오프셋이 반드시 존재해야 하며, 없으면 실패

---

## ⏰ 언제 적용되는가?

| 상황 | 적용 여부 |
|------|-----------|
| 컨슈머가 처음 토픽을 구독할 때 (새로운 groupId) | ✅ 적용됨 |
| 기존 groupId로 재시작 (오프셋 있음)           | ❌ 무시됨 |
| retention 기간 초과로 오프셋이 유효하지 않을 때 | ✅ 적용됨 |
| 컨슈머 재시작 시                              | 오프셋이 있다면 이전 위치부터 (reset 무시됨)

---

## ✅ Spring Kafka 설정 예시

```yaml
spring:
  kafka:
    consumer:
      auto-offset-reset: earliest
```

또는 Java 설정:

```java
props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");
```

---

## ✅ 요약

| 설정                     | 동작 |
|--------------------------|------|
| `earliest`               | 오프셋 없으면 가장 오래된 메시지부터 읽음 |
| `latest`                 | 오프셋 없으면 가장 마지막 메시지부터 읽음 |
| `none`                   | 오프셋 없으면 예외 발생 |
